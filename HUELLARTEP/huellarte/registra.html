<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Registro - Huellarte</title>
  <link rel="stylesheet" href="css/bootstrap.css">
  <script src="https://kit.fontawesome.com/923b6588de.js" crossorigin="anonymous"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
</head>
<header>
  <div>
  <nav class="navbar navbar-expand-lg bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html#"><img src="media/logo.png" width="200px" height="150px" alt="Huellarte Logo"></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav me-auto mb-2 mb-lg-0 Mimenu">
          <li class="nav-item">
            <a class="nav-link active" aria-current="page" href="index.html">Inicio</a>
          </li>
          <li class="nav-item Mimenu">
            <a class="nav-link" href="Servicio.html">Servicios</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Fundaciones.html">Fundaciones</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="Bienestar.html">Bienestar Animal</a>
            <li class="nav-item">
              <a class="nav-link" aria-disabled="true" href="index.html#Contacto">Contáctenos</a>
          </li>
          </li> 
           <li class="nav-item Mimenu">
            <a class="nav-link" href="index.html#Nosotros">Nosotros</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#" data-bs-toggle="modal" data-bs-target="#exampleModal">Ingresar</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
</header>
<body class="bg-light">
  <div class="container py-5">
      <div class="row justify-content-center">
          <div class="col-md-8 col-lg-6">
              <div class="card border-0 shadow-lg rounded-3 overflow-hidden">
                  <div class="card-header bg-primary text-white text-center py-4">
                      <h4 class="mb-0"><i class="fas fa-user-plus me-2"></i>Crear Cuenta</h4>
                  </div>
                  <div class="card-body p-4">
                      <div class="text-center mb-4">
                          <span class="badge bg-primary bg-opacity-10 text-primary fs-6 px-3 py-2 rounded-pill">¡Únete a nuestra comunidad!</span>
                      </div>
                      
                      <!-- Área de alertas -->
                      <div id="mensaje"></div>
                      
                      <form id="registrationForm" action="registro.php" method="POST">
                          <div class="row g-3">
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <input type="text" class="form-control" id="nombres" name="nombres" placeholder="Nombres" required>
                                      <label for="nombres"><i class="fas fa-user text-muted me-2"></i>Nombres</label>
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <input type="text" class="form-control" id="apellidos" name="apellidos" placeholder="Apellidos" required>
                                      <label for="apellidos"><i class="fas fa-user text-muted me-2"></i>Apellidos</label>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="row g-3">
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <select class="form-control" id="idTipodoc" name="idTipodoc" required>
                                          <option value="">Seleccionar...</option>
                                          <option value="1" id="1">Cédula de Ciudadanía</option>
                                          <option value="2" id="2">Tarjeta de Identidad</option>
                                          <option value="3" id="3">Cédula de Extranjería</option>
                                          <option value="4" id="5">Pasaporte</option>
                                      </select>
                                      <label for="idTipodoc"><i class="fas fa-id-card text-muted me-2"></i>Tipo de Documento</label>
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <input type="text" class="form-control" id="numeroDocumento" name="numeroDocumento" placeholder="Número de documento" required>
                                      <label for="numeroDocumento"><i class="fas fa-hashtag text-muted me-2"></i>Número de Documento</label>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="form-floating mb-3">
                              <input type="email" class="form-control" id="correo" name="correo" placeholder="correo@ejemplo.com" required>
                              <label for="correo"><i class="fas fa-envelope text-muted me-2"></i>Correo electrónico</label>
                          </div>
                          
                          <div class="form-floating mb-3">
                              <input type="tel" class="form-control" id="celular" name="celular" placeholder="Celular" required>
                              <label for="celular"><i class="fas fa-phone text-muted me-2"></i>Celular</label>
                          </div>
                          
                          <div class="row g-3">
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <select class="form-control" id="idDepartamento" name="idDepartamento" required>
                                          <option value="">Cargando departamentos...</option>
                                      </select>
                                      <label for="idDepartamento"><i class="fas fa-map-marker-alt text-muted me-2"></i>Departamento</label>
                                  </div>
                              </div>
                              <div class="col-md-6">
                                  <div class="form-floating mb-3">
                                      <select class="form-control" id="idCiudad" name="idCiudad" required disabled>
                                          <option value="">Selecciona un departamento primero</option>
                                      </select>
                                      <label for="idCiudad"><i class="fas fa-city text-muted me-2"></i>Ciudad</label>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="form-floating mb-3">
                              <input type="password" class="form-control" id="contrasena" name="contrasena" placeholder="Contraseña" required>
                              <label for="contrasena"><i class="fas fa-lock text-muted me-2"></i>Contraseña</label>
                              <div class="form-text">Mínimo 6 caracteres</div>
                          </div>
                          
                          <div class="form-floating mb-4">
                              <input type="password" class="form-control" id="confirmarPassword" name="confirmarPassword" placeholder="Confirmar contraseña" required>
                              <label for="confirmarPassword"><i class="fas fa-lock text-muted me-2"></i>Confirmar contraseña</label>
                          </div>
                          
                          <div class="mb-4">
                              <div class="d-flex justify-content-between align-items-center">
                                  <div class="form-check">
                                      <input class="form-check-input" type="checkbox" id="terminos" required>
                                      <label class="form-check-label" for="terminos">
                                          Acepto los <a href="#" class="text-decoration-none">términos y condiciones</a>
                                      </label>
                                  </div>
                              </div>
                          </div>
                          
                          <div class="d-grid">
                              <button type="submit" class="btn btn-primary btn-lg py-3" id="btnRegistrar">
                                  <i class="fas fa-user-plus me-2"></i>Registrarme ahora
                              </button>
                          </div>
                      </form>
                  </div>
                  <div class="card-footer bg-white py-3 border-0">
                      <div class="text-center">
                          <p class="mb-0">¿Ya tienes una cuenta? <a href="#" class="text-decoration-none">Iniciar sesión</a></p>
                      </div>
                      
                      <hr class="my-4">
                      
                      <div class="d-flex justify-content-center gap-3">
                          <button class="btn btn-outline-primary rounded-circle"><i class="fab fa-facebook-f"></i></button>
                          <button class="btn btn-outline-danger rounded-circle"><i class="fab fa-google"></i></button>
                          <button class="btn btn-outline-dark rounded-circle"><i class="fab fa-apple"></i></button>
                      </div>
                  </div>
              </div>
              
              <div class="text-center mt-4 text-muted">
                  <small>© 2025 Huellarte. Todos los derechos reservados.</small>
              </div>
          </div>
      </div>
  </div>
  
  <!-- Bootstrap JS Bundle -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  
  <script>
  // =========== CARGA DINÁMICA DE DEPARTAMENTOS Y CIUDADES ===========
  document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM cargado, iniciando aplicación...');
      
      // Cargar departamentos al cargar la página
      cargarDepartamentos();
      
      // Event listener para cambio de departamento
      document.getElementById('idDepartamento').addEventListener('change', function() {
          console.log('=== CAMBIO DE DEPARTAMENTO ===');
          console.log('Valor seleccionado:', this.value);
          console.log('Texto seleccionado:', this.options[this.selectedIndex].text);
          
          const idDepartamento = this.value;
          const selectCiudad = document.getElementById('idCiudad');
          
          if (idDepartamento) {
              console.log('Cargando ciudades para departamento:', idDepartamento);
              cargarCiudades(idDepartamento);
          } else {
              selectCiudad.innerHTML = '<option value="">Selecciona un departamento primero</option>';
              selectCiudad.disabled = true;
          }
      });
  });
  
  // Función para cargar departamentos
  async function cargarDepartamentos() {
      console.log('=== CARGANDO DEPARTAMENTOS ===');
      const selectDepartamento = document.getElementById('idDepartamento');
      
      try {
          selectDepartamento.innerHTML = '<option value="">Cargando departamentos...</option>';
          
          const response = await fetch('cargar_departamento.php');
          console.log('Response status departamentos:', response.status);
          
          const data = await response.json();
          console.log('Datos departamentos recibidos:', data);
          
          if (data.success) {
              selectDepartamento.innerHTML = '<option value="">Seleccionar departamento...</option>';
              data.data.forEach((dept, index) => {
                  console.log(`Departamento ${index + 1}:`, dept);
                  // CORREGIDO: Usar idDepartamento consistente
                  selectDepartamento.innerHTML += `<option value="${dept.idDepartamento}">${dept.descripcion}</option>`;
              });
              console.log('Departamentos cargados exitosamente');
          } else {
              selectDepartamento.innerHTML = '<option value="">Error al cargar departamentos</option>';
              console.error('Error del servidor:', data.message);
          }
      } catch (error) {
          console.error('Error al cargar departamentos:', error);
          selectDepartamento.innerHTML = '<option value="">Error de conexión</option>';
      }
  }
  
  // Función para cargar ciudades
  async function cargarCiudades(idDepartamento) {
      console.log('=== CARGANDO CIUDADES ===');
      console.log('ID Departamento recibido:', idDepartamento);
      console.log('Tipo:', typeof idDepartamento);
      
      const selectCiudad = document.getElementById('idCiudad');
      
      try {
          // Mostrar estado de carga
          selectCiudad.innerHTML = '<option value="">Cargando ciudades...</option>';
          selectCiudad.disabled = true;
          
          // Construir la URL
          const url = `cargar_ciudad.php?idDepartamento=${idDepartamento}`;
          console.log('URL llamada:', url);
          
          const response = await fetch(url);
          console.log('Response status ciudades:', response.status);
          
          const data = await response.json();
          console.log('Datos ciudades recibidos:', data);
          
          if (data.success) {
              console.log(`SUCCESS: ${data.data.length} ciudades encontradas`);
              selectCiudad.innerHTML = '<option value="">Seleccionar ciudad...</option>';
              
              data.data.forEach((ciudad, index) => {
                  console.log(`Ciudad ${index + 1}:`, ciudad);
                  selectCiudad.innerHTML += `<option value="${ciudad.idCiudad}">${ciudad.descripcion}</option>`;
              });
              
              selectCiudad.disabled = false;
              console.log('Ciudades cargadas exitosamente');
          } else {
              console.log('No se encontraron ciudades:', data.message);
              console.log('Debug info:', data.debug);
              selectCiudad.innerHTML = '<option value="">No hay ciudades disponibles</option>';
              selectCiudad.disabled = true;
          }
      } catch (error) {
          console.error('Error al cargar ciudades:', error);
          selectCiudad.innerHTML = '<option value="">Error al cargar ciudades</option>';
          selectCiudad.disabled = true;
      }
  }

  // =========== MANEJO DEL FORMULARIO DE REGISTRO ===========
  document.getElementById('registrationForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const btnRegistrar = document.getElementById('btnRegistrar');
      const originalText = btnRegistrar.innerHTML;
      
      // Cambiar botón a estado de carga
      btnRegistrar.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Registrando...';
      btnRegistrar.disabled = true;
      
      const formData = new FormData(this);
      
      // Validaciones adicionales del lado del cliente
      const contrasena = document.getElementById('contrasena').value;
      const confirmarPassword = document.getElementById('confirmarPassword').value;
      
      if (contrasena !== confirmarPassword) {
          mostrarMensaje('Las contraseñas no coinciden', 'danger');
          btnRegistrar.innerHTML = originalText;
          btnRegistrar.disabled = false;
          return;
      }
      
      if (contrasena.length < 6) {
          mostrarMensaje('La contraseña debe tener al menos 6 caracteres', 'danger');
          btnRegistrar.innerHTML = originalText;
          btnRegistrar.disabled = false;
          return;
      }
      
      try {
          const response = await fetch('registro.php', {
              method: 'POST',
              body: formData
          });
          
          const data = await response.json();
          
          if (data.success) {
              mostrarMensaje(data.message, 'success');
              this.reset();
              
              // Resetear los selects
              document.getElementById('idDepartamento').value = '';
              document.getElementById('idCiudad').innerHTML = '<option value="">Selecciona un departamento primero</option>';
              document.getElementById('idCiudad').disabled = true;
              
              // Opcional: redirigir después de un registro exitoso
              setTimeout(() => {
                  // window.location.href = 'login.html'; // o donde quieras redirigir
              }, 2000);
          } else {
              mostrarMensaje(data.message, 'danger');
          }
          
      } catch (error) {
          console.error('Error:', error);
          mostrarMensaje('Error de conexión. Por favor, intente nuevamente.', 'danger');
      } finally {
          // Restaurar botón
          btnRegistrar.innerHTML = originalText;
          btnRegistrar.disabled = false;
      }
  });
  
  function mostrarMensaje(mensaje, tipo) {
      const mensajeDiv = document.getElementById('mensaje');
      mensajeDiv.innerHTML = `
          <div class="alert alert-${tipo} alert-dismissible fade show" role="alert">
              ${mensaje}
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
      `;
      
      // Auto-ocultar después de 5 segundos
      setTimeout(() => {
          const alert = mensajeDiv.querySelector('.alert');
          if (alert) {
              const bsAlert = new bootstrap.Alert(alert);
              bsAlert.close();
          }
      }, 5000);
  }
  
  // Validación en tiempo real de confirmación de contraseña
  document.getElementById('confirmarPassword').addEventListener('input', function() {
      const contrasena = document.getElementById('contrasena').value;
      const confirmarPassword = this.value;
      
      if (confirmarPassword && contrasena !== confirmarPassword) {
          this.setCustomValidity('Las contraseñas no coinciden');
          this.classList.add('is-invalid');
      } else {
          this.setCustomValidity('');
          this.classList.remove('is-invalid');
      }
  });
  </script>
</body>
</html>